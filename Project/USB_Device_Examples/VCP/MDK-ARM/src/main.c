#include "gd32f10x.h"
#include "can_init.h"
#include "gd32f10x_rcc.h"
#include "hw_config.h"


/*==========================================================================================*/
void TIMER6_IRQHandler(void);
void Blink_TIM6(void);
/*==========================================================================================*/


/*==========================================================================================*/
RCC_ClocksPara RCC_Clocks;

int main(void)
{
	RCC_GetClocksFreq(&RCC_Clocks);
	
	uint16_t Count = 0;
	LEDs_init();
	init_CAN();
	while(1)
		
	{
				// ?????????? ???????
		if (Count == 0xffff)
		{
			// ???? ????? ?? ?????????, ?? ???????? ????????? ? ????
			Count = 0;
			CAN_Send_Test();

		} else {
			// ????? - ???????? ??????? ?? ???????
			Count++;
		}
	}

}

/*==========================================================================================*/
/*==========================================================================================*/
/*==========================================================================================*/
void Blink_TIM6(void)
{
	RCC->APB2CCR |= RCC_APB2CCR_PAEN;
	RCC->APB1CCR |= RCC_APB1CCR_TIMER6EN; 
	
	GPIOA->CTLR1 &= GPIO_CTLR1_CF4;
	GPIOA->CTLR1 &= GPIO_CTLR1_CF5;
	
	GPIOA->CTLR1 |= GPIO_CTLR1_MD4_0;
	GPIOA->CTLR1 |= GPIO_CTLR1_MD5_0;
	
	NVIC_EnableIRQ(TIMER6_IRQn);
	
	TIMER6->PSC = 24000 - 1; 							//???????? ??? 1000 ??? ? ???????
	TIMER6->CARL = 1000;									//?????????? ??? ? ???????
	TIMER6->DIE |= TIMER_DIE_UPIE;				//?????????? ?????????? ?? ???????
	TIMER6->CTLR1 |= TIMER_CTLR1_CNTE;	
}

void TIMER6_IRQHandler(void)
{
	TIMER6->STR &= ~TIMER_STR_UPIF;
	GPIOA->DOR^= (GPIO_DOR_DOR5 | GPIO_DOR_DOR4);
}

/*==========================================================================================*/
/*==========================================================================================*/
/*==========================================================================================*/





